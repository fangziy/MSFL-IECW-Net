# æ’æ˜Ÿå…‰è°±æ·±åº¦å­¦ä¹ åˆ†ææ¡†æ¶

<div align="center">

![Python](https://img.shields.io/badge/Python-3.8+-blue.svg)
![PyTorch](https://img.shields.io/badge/PyTorch-1.8+-red.svg)
![License](https://img.shields.io/badge/License-MIT-green.svg)

**ä¸€ä¸ªä¸“ä¸ºæ’æ˜Ÿå…‰è°±åˆ†æè®¾è®¡çš„æ·±åº¦å­¦ä¹ æ¡†æ¶ï¼Œä¸“æ³¨äºCEMPæ˜Ÿè¯†åˆ«å’Œæ’æ˜Ÿå¤§æ°”å‚æ•°é¢„æµ‹**

</div>

## ğŸ“‹ ç›®å½•

- [é¡¹ç›®ç®€ä»‹](#é¡¹ç›®ç®€ä»‹)
- [ä¸»è¦ç‰¹æ€§](#ä¸»è¦ç‰¹æ€§)
- [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
- [æ¨¡å‹æ¶æ„](#æ¨¡å‹æ¶æ„)
- [æ•°æ®æ ¼å¼](#æ•°æ®æ ¼å¼)
- [ä½¿ç”¨æŒ‡å—](#ä½¿ç”¨æŒ‡å—)
- [æ¨¡å‹èåˆ](#æ¨¡å‹èåˆ)
- [é…ç½®ç³»ç»Ÿ](#é…ç½®ç³»ç»Ÿ)
- [è¯„ä¼°æŒ‡æ ‡](#è¯„ä¼°æŒ‡æ ‡)
- [é¡¹ç›®ç»“æ„](#é¡¹ç›®ç»“æ„)
- [é«˜çº§åŠŸèƒ½](#é«˜çº§åŠŸèƒ½)
- [å­¦æœ¯èƒŒæ™¯](#å­¦æœ¯èƒŒæ™¯)

## ğŸŒŸ é¡¹ç›®ç®€ä»‹

æœ¬é¡¹ç›®æ˜¯ä¸€ä¸ªåŸºäºæ·±åº¦å­¦ä¹ çš„æ’æ˜Ÿå…‰è°±åˆ†ææ¡†æ¶ï¼Œä¸“é—¨ç”¨äºï¼š

- **CEMPæ˜Ÿè¯†åˆ«**: è¯†åˆ«ç¢³å¢å¼ºè´«é‡‘å±æ˜Ÿï¼ˆCarbon Enhanced Metal Poor starsï¼‰
- **æ’æ˜Ÿå¤§æ°”å‚æ•°å›å½’**: é¢„æµ‹é‡‘å±ä¸°åº¦ã€æœ‰æ•ˆæ¸©åº¦ã€è¡¨é¢é‡åŠ›ç­‰å‚æ•°
- **å¤šä»»åŠ¡å­¦ä¹ **: åŒæ—¶è¿›è¡Œåˆ†ç±»å’Œå›å½’ä»»åŠ¡
- **æ¨¡å‹èåˆ**: é›†æˆå¤šä¸ªæ¨¡å‹ä»¥æé«˜é¢„æµ‹æ€§èƒ½

### ç ”ç©¶æˆæœ

æœ¬é¡¹ç›®åŸºäºLAMOST DR8æ•°æ®é›†ï¼Œå®ç°äº†ï¼š
- **MPæ˜Ÿæœå¯»**: Recall=0.9592, Precision=0.9493, F1=0.9542
- **CEMPæ˜Ÿæœå¯»**: Recall=0.6428, Precision=0.7826, F1=0.7058
- **å‚æ•°ä¼°è®¡**: Teff MAE=74.9K, logg MAE=0.1749, [Fe/H] MAE=0.0889
- **å¤§è§„æ¨¡åº”ç”¨**: å‘ç°819,671é¢—è´«é‡‘å±æ˜Ÿå€™é€‰ä½“ï¼Œ12,766é¢—å¯Œç¢³è´«é‡‘å±æ˜Ÿå€™é€‰ä½“

## âœ¨ ä¸»è¦ç‰¹æ€§

### ğŸ—ï¸ å¤šç§ç¥ç»ç½‘ç»œæ¶æ„
- **MPBDNet**: å¤šåˆ†æ”¯åŒå‘å·ç§¯ç½‘ç»œï¼Œä¸“ä¸ºå…‰è°±åˆ†æè®¾è®¡
- **BGANet**: åŸºäºæ³¨æ„åŠ›æœºåˆ¶çš„åŒå‘GRUç½‘ç»œ
- **StarNet**: ç»å…¸çš„å¤©ä½“ç‰©ç†å…‰è°±åˆ†æç½‘ç»œ
- **RRNet**: æ®‹å·®ç½‘ç»œï¼Œæ”¯æŒå¤šç§æ¨¡å¼ï¼ˆraw/pre-RNN/post-RNNï¼‰

### ğŸ¯ çµæ´»çš„ä»»åŠ¡é…ç½®
- **åˆ†ç±»ä»»åŠ¡** (`cls`): CEMPæ˜Ÿä¸‰åˆ†ç±»ï¼ˆMP/CEMP/NMPï¼‰
- **å›å½’ä»»åŠ¡** (`reg`): äº”ä¸ªæ’æ˜Ÿå¤§æ°”å‚æ•°é¢„æµ‹
- **è”åˆä»»åŠ¡** (`cls_reg`): åŒæ—¶è¿›è¡Œåˆ†ç±»å’Œå›å½’

### ğŸ”§ å¼ºå¤§çš„å·¥å…·é›†
- **æ™ºèƒ½è®­ç»ƒ**: è‡ªåŠ¨å­¦ä¹ ç‡è°ƒåº¦ã€æ—©åœæœºåˆ¶
- **æ¨¡å‹èåˆ**: åŠ æƒå¹³å‡é›†æˆå¤šä¸ªæ¨¡å‹
- **ç‰¹å¾åˆ†æ**: å…‰è°±ç‰¹å¾é‡è¦æ€§åˆ†æ
- **æ•°æ®å¯è§†åŒ–**: æ•°æ®é¢„å¤„ç†å¯è§†åŒ–å·¥å…·

### ğŸ“Š ä¸“ä¸šè¯„ä¼°
- **CEMPæ˜Ÿä¸“é—¨æŒ‡æ ‡**: é’ˆå¯¹æ­£æ ·æœ¬çš„precision/recall/F1
- **å¤šçº§åˆ«è¯„ä¼°**: å•ç±»åˆ«å’Œæ•´ä½“åŠ æƒå¹³å‡æŒ‡æ ‡
- **å›å½’æŒ‡æ ‡**: MAEç­‰ä¸“ä¸šå¤©ä½“ç‰©ç†è¯„ä¼°æŒ‡æ ‡

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

```bash
Python >= 3.8
PyTorch >= 1.8
NumPy >= 1.19
Pandas >= 1.3
Scikit-learn >= 0.24
PyYAML >= 5.4
```

### å®‰è£…ç¯å¢ƒ

```bash
# åˆ›å»ºcondaç¯å¢ƒï¼ˆæ¨èï¼‰
conda create -n stellar_analysis python=3.8 pytorch==2.0.0 cudatoolkit=11.8 -c pytorch
conda activate stellar_analysis

# å®‰è£…ä¾èµ–
pip install numpy pandas scikit-learn pyyaml tqdm matplotlib seaborn
```

### æ•°æ®å‡†å¤‡

å°†æ‚¨çš„æ•°æ®æŒ‰ä»¥ä¸‹ç»“æ„ç»„ç»‡ï¼š

```
data/
â”œâ”€â”€ train/
â”‚   â”œâ”€â”€ X_train.npy    # è®­ç»ƒå…‰è°±æ•°æ® [N, spectrum_length]
â”‚   â””â”€â”€ y_train.csv    # è®­ç»ƒæ ‡ç­¾
â”œâ”€â”€ val/
â”‚   â”œâ”€â”€ X_val.npy      # éªŒè¯å…‰è°±æ•°æ®
â”‚   â””â”€â”€ y_val.csv      # éªŒè¯æ ‡ç­¾
â””â”€â”€ spectra/           # åŸå§‹å…‰è°±æ–‡ä»¶ï¼ˆå¯é€‰ï¼‰
```

### åŸºç¡€ä½¿ç”¨

```bash
# è®­ç»ƒCEMPæ˜Ÿåˆ†ç±»æ¨¡å‹
python train.py --config=./config/MPBD_cls.yaml

# è®­ç»ƒæ’æ˜Ÿå‚æ•°å›å½’æ¨¡å‹
python train.py --config=./config/MPBD_reg.yaml

# éªŒè¯æ¨¡å‹æ€§èƒ½
python val.py --config=./config/MPBD_cls.yaml

# æ¨¡å‹èåˆ
python ensemble.py --config=./config/ensemble_cls.yaml
```

## ğŸ›ï¸ æ¨¡å‹æ¶æ„

### MPBDNet - å¤šåˆ†æ”¯åŒå‘ç½‘ç»œ
```
è¾“å…¥å…‰è°± â†’ å¤šåˆ†æ”¯å·ç§¯ â†’ åµŒå…¥å±‚ â†’ åŒå‘LSTM â†’ å…¨è¿æ¥ â†’ è¾“å‡º
         â†“
    [3x3å·ç§¯ + 5x7å·ç§¯] â†’ æ± åŒ– â†’ åºåˆ—å»ºæ¨¡ â†’ ä»»åŠ¡å¤´
```
- **ä¼˜åŠ¿**: å¤šå°ºåº¦ç‰¹å¾æå–ï¼Œé€‚åˆå…‰è°±æ•°æ®çš„é¢‘ç‡ç‰¹æ€§
- **é€‚ç”¨**: é«˜ç²¾åº¦è¦æ±‚çš„åˆ†ç±»å’Œå›å½’ä»»åŠ¡

### BGANet - æ³¨æ„åŠ›ç½‘ç»œ
```
è¾“å…¥å…‰è°± â†’ åˆ†æ®µ â†’ å¤šå±‚GRU â†’ å¤šå¤´æ³¨æ„åŠ› â†’ èšåˆ â†’ è¾“å‡º
```
- **ä¼˜åŠ¿**: æ³¨æ„åŠ›æœºåˆ¶èšç„¦é‡è¦å…‰è°±åŒºåŸŸ
- **é€‚ç”¨**: éœ€è¦è§£é‡Šæ€§çš„å…‰è°±åˆ†æ

### StarNet - ç»å…¸ç½‘ç»œ
```
è¾“å…¥å…‰è°± â†’ å·ç§¯å±‚ â†’ æ± åŒ– â†’ å…¨è¿æ¥ â†’ è¾“å‡º
```
- **ä¼˜åŠ¿**: ç»“æ„ç®€å•ï¼Œè®­ç»ƒå¿«é€Ÿ
- **é€‚ç”¨**: åŸºå‡†æµ‹è¯•å’Œå¿«é€ŸåŸå‹

### RRNet - æ®‹å·®ç½‘ç»œ
```
è¾“å…¥å…‰è°± â†’ [æ®‹å·®å— Ã— N] â†’ RNN(å¯é€‰) â†’ å…¨è¿æ¥ â†’ è¾“å‡º
```
- **ä¼˜åŠ¿**: æ·±å±‚ç½‘ç»œï¼Œæ¢¯åº¦æµåŠ¨å¥½
- **é€‚ç”¨**: å¤§è§„æ¨¡æ•°æ®é›†è®­ç»ƒ

## ğŸ“Š æ•°æ®æ ¼å¼

### å…‰è°±æ•°æ®
- **æ ¼å¼**: NumPyæ•°ç»„ (.npy)
- **å½¢çŠ¶**: `[æ ·æœ¬æ•°, å…‰è°±é•¿åº¦]`
- **èŒƒå›´**: é€šå¸¸å·²å½’ä¸€åŒ–åˆ° [0, 1] æˆ–æ ‡å‡†åŒ–

### æ ‡ç­¾æ•°æ®
- **æ ¼å¼**: CSVæ–‡ä»¶
- **å›å½’æ ‡ç­¾**: `["FeH", "CH", "Teff", "logg", "CFe"]`
  - FeH: é“ä¸°åº¦ [Fe/H]
  - CH: ç¢³ä¸°åº¦ [C/H]
  - Teff: æœ‰æ•ˆæ¸©åº¦ (K)
  - logg: è¡¨é¢é‡åŠ› log(g)
  - CFe: ç¢³é“æ¯” [C/Fe]
- **åˆ†ç±»æ ‡ç­¾**: `['f_CEMP']`
  - 0: MP (Metal Poor) - è´«é‡‘å±æ˜Ÿ
  - 1: CEMP (Carbon Enhanced Metal Poor) - ç¢³å¢å¼ºè´«é‡‘å±æ˜Ÿ
  - 2: NMP (Non Metal Poor) - éè´«é‡‘å±æ˜Ÿ

## ğŸ“– ä½¿ç”¨æŒ‡å—

### è®­ç»ƒæ¨¡å‹

```bash
# åŸºç¡€è®­ç»ƒ
python train.py --config=config/æ¨¡å‹_ä»»åŠ¡.yaml

# æŒ‡å®šGPU
CUDA_VISIBLE_DEVICES=0 python train.py --config=config/BGANet_cls.yaml

# ä»æ£€æŸ¥ç‚¹æ¢å¤
python train.py --config=config/MPBD_reg.yaml
```

### éªŒè¯å’Œæµ‹è¯•

```bash
# éªŒè¯å•ä¸ªæ¨¡å‹
python val.py --config=config/StarNet_cls.yaml

# åœ¨å…¨éƒ¨æ•°æ®ä¸Šè¯„ä¼°
python val.py --config=config/RRNet_reg.yaml
```

### ç‰¹å¾é‡è¦æ€§åˆ†æ

```bash
# åˆ†æå…‰è°±ç‰¹å¾é‡è¦æ€§
python feature_importance_analysis.py --config=config/MPBD_cls.yaml --num_noise_block=10
```

### æ•°æ®å¯è§†åŒ–

```bash
# æ•°æ®é¢„å¤„ç†å¯è§†åŒ–
python tools/vision_data_prepocess.py
```

### æ•°æ®å¢å¼º

æ¡†æ¶æ”¯æŒå¤šç§å…‰è°±æ•°æ®å¢å¼ºæ–¹æ³•ï¼Œé€šè¿‡é…ç½®æ–‡ä»¶çµæ´»æ§åˆ¶ï¼š

```bash
# ä½¿ç”¨æ•°æ®å¢å¼ºè®­ç»ƒ
python train.py --config=config/MPBD_cls_with_augmentation.yaml

# æµ‹è¯•æ•°æ®å¢å¼ºåŠŸèƒ½
python test_augmentation.py
```

**æ”¯æŒçš„å¢å¼ºæ–¹æ³•**ï¼š
- **é«˜æ–¯å™ªå£°**: æ¨¡æ‹Ÿä»ªå™¨å™ªå£°
- **å…‰è°±ç¼©æ”¾**: æ¨¡æ‹Ÿä»ªå™¨å“åº”å·®å¼‚  
- **åŸºçº¿æ¼‚ç§»**: æ¨¡æ‹Ÿè§‚æµ‹æ¡ä»¶å˜åŒ–
- **æ³¢é•¿è½´åç§»**: æ¨¡æ‹Ÿå…‰è°±æ ¡å‡†è¯¯å·®
- **å…‰è°±å¹³æ»‘**: æ¨¡æ‹Ÿä¸åŒåˆ†è¾¨ç‡
- **å…‰è°±dropout**: æ¨¡æ‹Ÿéƒ¨åˆ†æ³¢æ®µç¼ºå¤±

**é…ç½®ç¤ºä¾‹**ï¼š
```yaml
# åœ¨é…ç½®æ–‡ä»¶ä¸­æ·»åŠ æ•°æ®å¢å¼º
data_augmentation:
  probability: 0.6  # 60%çš„æ ·æœ¬ä¼šè¢«å¢å¼º
  methods:
    gaussian_noise:
      enabled: True
      probability: 0.4
      std: 0.008
    spectral_scaling:
      enabled: True  
      probability: 0.3
      range: 0.08
```

## ğŸ”„ æ¨¡å‹èåˆ

æ¨¡å‹èåˆé€šè¿‡é›†æˆå¤šä¸ªæ¨¡å‹æ¥æé«˜é¢„æµ‹æ€§èƒ½ï¼Œç‰¹åˆ«é€‚åˆæå‡CEMPæ˜Ÿè¯†åˆ«çš„å‡†ç¡®æ€§ã€‚

### åŸºæœ¬ç”¨æ³•

```bash
# åˆ†ç±»ä»»åŠ¡èåˆ
python ensemble.py --config=config/ensemble_cls.yaml

# å›å½’ä»»åŠ¡èåˆ  
python ensemble.py --config=config/ensemble_reg.yaml

# è”åˆä»»åŠ¡èåˆ
python ensemble.py --config=config/ensemble_cls_reg.yaml

# ä¿å­˜é¢„æµ‹ç»“æœ
python ensemble.py --config=config/ensemble_cls.yaml --save_predictions --output_dir=./results
```

### é…ç½®ç¤ºä¾‹

```yaml
# èåˆé…ç½®æ–‡ä»¶
object_type: 'cls'
data_dir: "data/"

models:
  - name: 'MPBDNet'
    path: 'model_save/MPBD_cls/best.pth'
    weight: 1.2  # æ€§èƒ½æœ€å¥½ï¼Œæƒé‡æœ€é«˜
    
  - name: 'BGANet'
    path: 'model_save/BGANet_cls/best.pth'
    weight: 1.0
    
  - name: 'StarNet'
    path: 'model_save/StarNet_cls/best.pth'
    weight: 0.8  # åŸºå‡†æ¨¡å‹ï¼Œæƒé‡è¾ƒä½
```

### èåˆç­–ç•¥
- **åŠ æƒå¹³å‡**: æ ¹æ®æ¨¡å‹æ€§èƒ½åˆ†é…æƒé‡
- **è‡ªåŠ¨å½’ä¸€åŒ–**: æƒé‡è‡ªåŠ¨æ ‡å‡†åŒ–
- **çµæ´»ç»„åˆ**: æ”¯æŒä»»æ„æ¨¡å‹æ¶æ„ç»„åˆ

## âš™ï¸ é…ç½®ç³»ç»Ÿ

### é…ç½®æ–‡ä»¶ç»“æ„

```yaml
# åŸºæœ¬é…ç½®
object_type: 'cls'          # ä»»åŠ¡ç±»å‹: 'cls', 'reg', 'cls_reg'
data_dir: "data/"           # æ•°æ®ç›®å½•
object_name: 'MPBD_cls'     # å®éªŒåç§°

# æ•°æ®é…ç½®
reg_columns: ["FeH", "CH", "Teff", "logg", "CFe"]
cls_columns: ['f_CEMP']
cls_dict: {0: 'MP', 1: 'CEMP', 2: 'NMP'}

# æ ‡å‡†åŒ–å‚æ•°
y_mean: [-8.81020067e-01, -9.78005818e-01, 4.91095684e+03, 2.55795385e+00, -9.69857512e-02]
y_std: [7.61077821e-01, 8.42965361e-01, 4.97515564e+02, 1.15882902e+00, 3.06636238e-01]

# æ¨¡å‹é…ç½®
model:
  name: 'MPBDNet'
  list_inplanes: [20,40,80,160]
  len_spectrum: 4900

# è®­ç»ƒé…ç½®
lr: 0.0001
num_epochs: 200

# æŸå¤±å‡½æ•°
loss:
  cls_loss:
    loss_name: 'CrossEntropyLoss'
    rate: 1.0

# å­¦ä¹ ç‡è°ƒåº¦
scheduler:
  name: 'StepLR'
  step_size: 30
  gamma: 0.75

# æ¨¡å‹ä¿å­˜
resume_from: 'model_save/MPBD_cls/best.pth'
```

### å¯ç”¨é…ç½®æ–‡ä»¶

- **åˆ†ç±»ä»»åŠ¡**: `*_cls.yaml`
- **å›å½’ä»»åŠ¡**: `*_reg.yaml`  
- **è”åˆä»»åŠ¡**: `*_cls_reg.yaml`
- **èåˆé…ç½®**: `ensemble_*.yaml`

## ğŸ“ˆ è¯„ä¼°æŒ‡æ ‡

### åˆ†ç±»æŒ‡æ ‡ï¼ˆä¸“é—¨é’ˆå¯¹CEMPæ˜Ÿï¼‰

```
=== CEMPæ˜Ÿï¼ˆæ­£æ ·æœ¬ï¼‰æŒ‡æ ‡ ===
CEMP precision: 0.856
CEMP recall: 0.792  
CEMP f1: 0.823

=== æ•´ä½“åŠ æƒå¹³å‡æŒ‡æ ‡ ===
weighted precision: 0.834
weighted recall: 0.841
weighted f1: 0.837
```

### å›å½’æŒ‡æ ‡

```
=== å›å½’æŒ‡æ ‡ ===
MAE: [FeH: 0.089, CH: 0.076, Teff: 45.23K, logg: 0.123, CFe: 0.067]
```

### èåˆæå‡æ•ˆæœ

å…¸å‹çš„èåˆæ•ˆæœï¼š
- å•æ¨¡å‹æœ€ä½³: CEMP F1 = 0.823
- èåˆæ¨¡å‹: CEMP F1 = 0.856 â†‘ (+4.0%)
- æ•´ä½“å‡†ç¡®ç‡: 84.1% â†’ 87.3% â†‘ (+3.2%)

## ğŸ“ é¡¹ç›®ç»“æ„

```
thesis/
â”œâ”€â”€ config/                 # é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ MPBD_cls.yaml       # MPBDåˆ†ç±»é…ç½®
â”‚   â”œâ”€â”€ BGANet_reg.yaml     # BGANetå›å½’é…ç½®
â”‚   â”œâ”€â”€ ensemble_cls.yaml   # åˆ†ç±»èåˆé…ç½®
â”‚   â””â”€â”€ ...
â”œâ”€â”€ models/                 # æ¨¡å‹å®šä¹‰
â”‚   â”œâ”€â”€ MPBDNet.py         # MPBDç½‘ç»œ
â”‚   â”œâ”€â”€ BGANet.py          # BGAç½‘ç»œ
â”‚   â”œâ”€â”€ StarNet.py         # Starç½‘ç»œ
â”‚   â”œâ”€â”€ RRNet.py           # RRç½‘ç»œ
â”‚   â”œâ”€â”€ create/            # å·¥å…·æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ create_loss.py # æŸå¤±å‡½æ•°
â”‚   â”‚   â””â”€â”€ create_scheduler.py # è°ƒåº¦å™¨
â”‚   â””â”€â”€ loss/              # æŸå¤±å‡½æ•°
â”‚       â”œâ”€â”€ focal.py       # Focal Loss
â”‚       â””â”€â”€ gaussian_nll.py # é«˜æ–¯NLLæŸå¤±
â”œâ”€â”€ data/                  # æ•°æ®ç›®å½•
â”‚   â”œâ”€â”€ train/             # è®­ç»ƒæ•°æ®
â”‚   â”œâ”€â”€ val/               # éªŒè¯æ•°æ®
â”‚   â””â”€â”€ spectra/           # åŸå§‹å…‰è°±
â”œâ”€â”€ model_save/            # æ¨¡å‹æƒé‡
â”œâ”€â”€ tools/                 # å·¥å…·è„šæœ¬
â”‚   â””â”€â”€ vision_data_prepocess.py
â”œâ”€â”€ utils/                 # å·¥å…·å‡½æ•°
â”œâ”€â”€ train.py              # è®­ç»ƒè„šæœ¬
â”œâ”€â”€ val.py                # éªŒè¯è„šæœ¬
â”œâ”€â”€ ensemble.py           # æ¨¡å‹èåˆ
â”œâ”€â”€ feature_importance_analysis.py # ç‰¹å¾åˆ†æ
â””â”€â”€ README.md
```

## ğŸ”¬ é«˜çº§åŠŸèƒ½

### 1. è‡ªé€‚åº”æŸå¤±å‡½æ•°
- **Focal Loss**: å¤„ç†ç±»åˆ«ä¸å¹³è¡¡
- **Gaussian NLL**: ä¸ç¡®å®šæ€§é‡åŒ–
- **åŠ æƒæŸå¤±**: è‡ªå®šä¹‰ç±»åˆ«æƒé‡

### 2. å­¦ä¹ ç‡è°ƒåº¦
- **StepLR**: é˜¶æ¢¯å¼è¡°å‡
- **CosineAnnealingLR**: ä½™å¼¦é€€ç«
- **ReduceLROnPlateau**: è‡ªé€‚åº”è°ƒæ•´

### 3. ç‰¹å¾é‡è¦æ€§åˆ†æ
```bash
python feature_importance_analysis.py \
    --config=config/MPBD_cls.yaml \
    --num_noise_block=10
```

### 4. æ¨¡å‹è§£é‡Šæ€§
- æ³¨æ„åŠ›æƒé‡å¯è§†åŒ–ï¼ˆBGANetï¼‰
- ç‰¹å¾æ•æ„Ÿæ€§åˆ†æ
- å…‰è°±åŒºåŸŸé‡è¦æ€§è¯„ä¼°

### 5. ç”Ÿäº§éƒ¨ç½²
- æ¨¡å‹æƒé‡ä¿å­˜/åŠ è½½
- é¢„æµ‹ç»“æœå¯¼å‡º
- æ‰¹é‡æ¨ç†æ”¯æŒ

### 6. å…‰è°±æ•°æ®å¢å¼º
```bash
# æ•°æ®å¢å¼ºé…ç½®ç¤ºä¾‹
data_augmentation:
  probability: 0.6  # æ•´ä½“å¢å¼ºæ¦‚ç‡
  methods:
    gaussian_noise:     # é«˜æ–¯å™ªå£°
      enabled: True
      probability: 0.4
      std: 0.008
    spectral_scaling:   # å…‰è°±ç¼©æ”¾
      enabled: True
      probability: 0.3
      range: 0.08
    baseline_drift:     # åŸºçº¿æ¼‚ç§»
      enabled: True
      probability: 0.35
      strength: 0.015
    wavelength_shift:   # æ³¢é•¿åç§»
      enabled: True
      probability: 0.25
      max_shift: 3
```

**å¢å¼ºæ–¹æ³•è¯´æ˜**ï¼š
- **é€‚ç”¨åœºæ™¯**: å°æ ·æœ¬å­¦ä¹ ã€æé«˜æ¨¡å‹æ³›åŒ–æ€§
- **ç‰©ç†æ„ä¹‰**: æ¨¡æ‹ŸçœŸå®è§‚æµ‹ä¸­çš„å„ç§è¯¯å·®å’Œå˜åŒ–
- **é…ç½®çµæ´»**: æ¯ç§æ–¹æ³•å¯ç‹¬ç«‹å¯ç”¨/ç¦ç”¨å’Œè°ƒå‚
- **è®­ç»ƒä¸“ç”¨**: ä»…åœ¨è®­ç»ƒæ—¶åº”ç”¨ï¼ŒéªŒè¯æ—¶ä¸ä½¿ç”¨

## ğŸ¯ æœ€ä½³å®è·µ

### è®­ç»ƒå»ºè®®
1. **æ•°æ®é¢„å¤„ç†**: ç¡®ä¿å…‰è°±æ•°æ®å·²æ­£ç¡®å½’ä¸€åŒ–
2. **è¶…å‚æ•°è°ƒä¼˜**: å…ˆç”¨å°å­¦ä¹ ç‡æ‰¾åˆ°æ”¶æ•›èŒƒå›´
3. **æ—©åœæœºåˆ¶**: ç›‘æ§éªŒè¯æŸå¤±é¿å…è¿‡æ‹Ÿåˆ
4. **æ¨¡å‹é€‰æ‹©**: MPBDå’ŒBGANeté€šå¸¸è¡¨ç°æœ€ä½³
5. **æ•°æ®å¢å¼º**: 
   - å°æ ·æœ¬æ•°æ®é›†å»ºè®®ä½¿ç”¨è½»é‡çº§å¢å¼º
   - å¤§æ ·æœ¬æ•°æ®é›†å¯ä½¿ç”¨æ›´æ¿€è¿›çš„å¢å¼ºç­–ç•¥
   - å…ˆä¸ç”¨å¢å¼ºå»ºç«‹åŸºçº¿ï¼Œå†é€æ­¥æ·»åŠ å¢å¼ºæ–¹æ³•

### èåˆç­–ç•¥
1. **æ¨¡å‹å¤šæ ·æ€§**: é€‰æ‹©ä¸åŒæ¶æ„çš„æ¨¡å‹èåˆ
2. **æƒé‡è°ƒä¼˜**: æ ¹æ®éªŒè¯é›†æ€§èƒ½è°ƒæ•´æƒé‡
3. **ç»“æœåˆ†æ**: å…³æ³¨CEMPæ˜Ÿçš„ä¸“é—¨æŒ‡æ ‡

### æ€§èƒ½ä¼˜åŒ–
1. **æ‰¹é‡å¤§å°**: æ ¹æ®GPUå†…å­˜è°ƒæ•´
2. **æ··åˆç²¾åº¦**: ä½¿ç”¨FP16åŠ é€Ÿè®­ç»ƒ
3. **æ•°æ®å¹¶è¡Œ**: å¤šGPUè®­ç»ƒå¤§å‹æ¨¡å‹

## ğŸ“š å­¦æœ¯èƒŒæ™¯

### LAMOSTä¸CEMPæ˜Ÿç ”ç©¶

å¤§å¤©åŒºé¢ç§¯å¤šç›®æ ‡å…‰çº¤å…‰è°±æœ›è¿œé•œ (LAMOST) æ˜¯æˆ‘å›½è‡ªä¸»ç ”å‘çš„å¤§å‹å…‰å­¦è§‚æµ‹è®¾å¤‡ï¼Œä¸ºå¤©æ–‡å­¦ç ”ç©¶æä¾›äº†å…³é”®çš„æ•°æ®æ”¯æŒã€‚è´«é‡‘å±(Metal-Poor, MP)æ˜Ÿæ˜¯ä¸€ç±»ç¨€æœ‰è€Œå¤è€çš„æ’æ˜Ÿï¼Œè€Œç¢³å¢å¼ºè´«é‡‘å±(Carbon-Enhanced Metal-Poor, CEMP)æ˜Ÿåˆ™æ˜¯å…¶ä¸­çš„é‡è¦å­ç±»ï¼Œæ˜¾ç¤ºå‡ºç›¸å¯¹äºé“å…ƒç´ çš„ç¢³å¯Œé›†æ•ˆåº”ã€‚

CEMPæ˜Ÿè¢«è®¤ä¸ºæ˜¯ç”±å¤§çˆ†ç‚¸åç¬¬ä¸€ä»£æ’æ˜Ÿæ±¡æŸ“çš„æ°”ä½“å½¢æˆçš„ï¼Œæ˜¯ç ”ç©¶æ—©æœŸå®‡å®™ã€æ˜Ÿç³»æ¼”åŒ–å’Œæ ¸åˆæˆçš„é‡è¦å¯¹è±¡ã€‚æœ¬é¡¹ç›®é’ˆå¯¹MPåŠCEMPæ ·æœ¬çš„ç¨€ç¼ºæ€§é—®é¢˜ï¼Œè®¾è®¡äº†æ·±åº¦å­¦ä¹ æ–¹æ³•æ¥æé«˜è¿™ä¸¤ç±»æ ·æœ¬çš„æ£€å‡ºç‡å’Œå‚æ•°ä¼°è®¡ç²¾åº¦ã€‚

### æ•°æ®é›†æ„å»º

æœ¬å·¥ä½œä½¿ç”¨LAMOST DR8æ•°æ®é›†ï¼š
- **éè´«é‡‘å±æ˜Ÿæ ·æœ¬**: 4,723ä¸ª
- **è´«é‡‘å±æ˜Ÿæ ·æœ¬**: 5,032ä¸ªï¼ˆåŒ…å«167ä¸ªCEMPæ˜Ÿï¼‰
- **æ ‡ç­¾æ¥æº**: APOGEE DR17ã€LAMOST-Subaruã€SAGAæ•°æ®åº“
- **é¢„å¤„ç†**: ç»Ÿä¸€æ³¢æ®µæ’å€¼ã€è¿ç»­è°±æ‹Ÿåˆã€å½’ä¸€åŒ–

### æ ¸å¿ƒè´¡çŒ®

1. **å¤šå°ºåº¦ç‰¹å¾å­¦ä¹ **: æå‡ºMSFL-IECWç½‘ç»œï¼Œä½¿ç”¨å¤šå°ºåº¦å·ç§¯å’Œè·¨æ³¢æ®µLSTM
2. **åˆ†ç±»çº¦æŸå›å½’**: åŸºäºåˆ†ç±»çº¦æŸçš„å›å½’æ–¹æ³•ï¼Œé¿å…å‚æ•°ä¼°è®¡çš„ç‰©ç†çŸ›ç›¾
3. **å¤§è§„æ¨¡åº”ç”¨**: åœ¨LAMOST DR8ä¸Šå‘ç°å¤§é‡MPå’ŒCEMPæ˜Ÿå€™é€‰ä½“
4. **æœªæ¥å±•æœ›**: å¯åº”ç”¨äºCSSTç­‰å¤§å‹ç©ºé—´å¤©æ–‡è®¾æ–½

## ğŸ“ è”ç³»æ–¹å¼

- **ä½œè€…**: Ziyu Fang
- **é‚®ç®±**: fangziyushiwo@126.com
- **æ—¥æœŸ**: 2024-12-25

### å¼•ç”¨æ ¼å¼
```bibtex
@misc{stellar_spectrum_dl_2024,
  title={Deep Learning Framework for Stellar Spectrum Analysis and CEMP Star Identification},
  author={Ziyu Fang},
  year={2024},
  note={Framework for stellar parameter estimation and CEMP star search using LAMOST DR8 data}
}
```

---

<div align="center">

**ğŸŒŸ å¦‚æœè¿™ä¸ªé¡¹ç›®å¯¹æ‚¨çš„ç ”ç©¶æœ‰å¸®åŠ©ï¼Œè¯·ç»™ä¸ªStarï¼**

*ä¸“ä¸ºå¤©ä½“ç‰©ç†å­¦å®¶å’Œæ•°æ®ç§‘å­¦å®¶è®¾è®¡çš„æ’æ˜Ÿå…‰è°±åˆ†æå·¥å…·*

</div>

```
Author: Ziyu Fang
Date: 2024-12-25
Email: fangziyushiwo@126.com
```

## ç¯å¢ƒå‡†å¤‡

```
conda create -n MPDB python=3.12 pytorch==2.2.2 cudatoolkit=11.8

pip install -r requirements.txt
```

## é¡¹ç›®ç»“æ„

```
project/

â”œâ”€â”€ data/ Â Â Â Â Â Â Â Â # æ•°æ®é›†

     â”œâ”€â”€ spectra/

     â”œâ”€â”€ train/

     â””â”€â”€ val/

â”œâ”€â”€ utils/ Â Â Â Â Â Â Â 

â”œâ”€â”€ models/ Â Â Â Â Â Â Â Â 

â”œâ”€â”€ train.py Â Â 

â”œâ”€â”€ val.py Â Â 

â””â”€â”€ README.md Â Â Â Â # é¡¹ç›®è¯´æ˜æ–‡æ¡£

```

## æ•°æ®é›†å‡†å¤‡

æ•°æ®é›†ä¸ºä¸€ä¸ªcsvè¡¨æ ¼æ•°æ®ã€‚

å¯ä»¥é€šè¿‡åœ¨é…ç½®æ–‡ä»¶ä¸­æŒ‡å®šfeatures_nameæ¥åŒºåˆ†Xå’Œï¼Œyã€‚å…¶ä¸­æœ€åä¸€åˆ—ä¸ºyï¼Œå…¶ä½™åˆ—ä¸ºXã€‚

## é…ç½®æ–‡ä»¶

```
#é¡¹ç›®åç§°
object_name: 'MPBD_reg'
æ•°æ®è·¯å¾„
data_dir : "./data"

#ä»»åŠ¡ç±»å‹
object_type: 'reg'
#å›å½’éƒ¨åˆ†åˆ—å
reg_columns : ["FeH", "CH", "Teff", "logg", "CFe"]
#åˆ†ç±»éƒ¨åˆ†åˆ—å
cls_columns: ['f_CEMP']
cls_dict: {0: 'MP', 1: 'CEMP', 2: 'NMP'}
num_classes: 3

#å›å½’æ ‡ç­¾å½’ä¸€åŒ–
y_mean : [-8.81020067e-01, -9.78005818e-01, 4.91095684e+03, 2.55795385e+00, -9.69857512e-02]
y_std : [7.61077821e-01, 8.42965361e-01, 4.97515564e+02, 1.15882902e+00, 3.06636238e-01]

#æ¨¡å‹é€‰æ‹©
model: 'MPBDNet'
#æ¨¡å‹å‚æ•°é€‰æ‹©
list_inplanes: [20,40,80,160]
lr: 0.0001
#æŸå¤±å‡½æ•°
loss: 'MSELoss'
#ç»§ç»­è®­ç»ƒ
resume_from : 'D:/Notebook_workdir/thesis/model_save/MPBD_reg/best.pth'
```

## è®­ç»ƒ

```

#configä¸­ç»™å‡ºé…ç½®æ–‡ä»¶çš„è·¯å¾„
python train.py --config=./config/MPBD_reg.yaml

```

## éªŒè¯

```

python val.py --config=./config/MPBD_reg.yaml

```


##æ•°æ®å¤„ç†å¯è§†åŒ–
```

python D:\Notebook_workdir\thesis\tools\vision_data_prepocess.py

```

## æ¨¡å‹èåˆ

æ¨¡å‹èåˆåŠŸèƒ½å¯ä»¥å°†å¤šä¸ªå·²è®­ç»ƒçš„æ¨¡å‹ç»„åˆèµ·æ¥ï¼Œé€šè¿‡é›†æˆå­¦ä¹ æé«˜é¢„æµ‹æ€§èƒ½ã€‚

### åŸºæœ¬ä½¿ç”¨

```bash
# ä½¿ç”¨é¢„å®šä¹‰çš„é…ç½®æ–‡ä»¶è¿›è¡Œæ¨¡å‹èåˆ
python ensemble.py --config=./config/ensemble_cls.yaml

# ä¿å­˜é¢„æµ‹ç»“æœåˆ°æŒ‡å®šç›®å½•
python ensemble.py --config=./config/ensemble_cls.yaml --save_predictions --output_dir=./results

```

### é…ç½®æ–‡ä»¶è¯´æ˜

**åˆ†ç±»ä»»åŠ¡èåˆ**:
```bash
python ensemble.py --config=./config/ensemble_cls.yaml
```

**å›å½’ä»»åŠ¡èåˆ**:
```bash
python ensemble.py --config=./config/ensemble_reg.yaml
```

**åˆ†ç±»+å›å½’è”åˆä»»åŠ¡èåˆ**:
```bash
python ensemble.py --config=./config/ensemble_cls_reg.yaml
```

**ç®€å•ç­‰æƒé‡èåˆ**:
```bash
python ensemble.py --config=./config/ensemble_simple.yaml
```

### é…ç½®æ–‡ä»¶æ ¼å¼

```yaml
# åŸºæœ¬ä»»åŠ¡é…ç½®
object_type: 'cls'  # 'cls', 'reg', 'cls_reg'
data_dir: "è·¯å¾„/åˆ°/æ•°æ®ç›®å½•"

# èåˆæ¨¡å‹åˆ—è¡¨
models:
  - name: 'StarNet'
    path: 'æ¨¡å‹æƒé‡æ–‡ä»¶è·¯å¾„'
    weight: 1.0  # æ¨¡å‹æƒé‡ï¼Œæ•°å€¼è¶Šå¤§å½±å“è¶Šå¤§
    len_spectrum: 4900
    
  - name: 'RRNet'
    path: 'æ¨¡å‹æƒé‡æ–‡ä»¶è·¯å¾„'
    weight: 1.2  # ç»™è¡¨ç°æ›´å¥½çš„æ¨¡å‹æ›´é«˜æƒé‡
    list_inplanes: [20,40,80,160]
    len_spectrum: 3834
    mode: 'post-RNN'
```

### è¾“å‡ºç»“æœ

èåˆåä¼šè¾“å‡ºï¼š
- **é›†æˆæ¨¡å‹å‡†ç¡®ç‡**: æ•´ä½“é¢„æµ‹å‡†ç¡®æ€§
- **CEMPæ˜Ÿä¸“é—¨æŒ‡æ ‡**: é’ˆå¯¹CEMPæ˜Ÿçš„precisionã€recallã€F1
- **æ•´ä½“åŠ æƒå¹³å‡æŒ‡æ ‡**: è€ƒè™‘ç±»åˆ«å¹³è¡¡çš„æ•´ä½“æ€§èƒ½
- **MAE**: å›å½’ä»»åŠ¡çš„å¹³å‡ç»å¯¹è¯¯å·®

### é«˜çº§åŠŸèƒ½

1. **è‡ªå®šä¹‰æƒé‡**: å¯ä»¥æ ¹æ®å•ä¸ªæ¨¡å‹æ€§èƒ½è°ƒæ•´æƒé‡
2. **è‡ªåŠ¨å½’ä¸€åŒ–**: æƒé‡ä¼šè‡ªåŠ¨å½’ä¸€åŒ–ï¼Œç¡®ä¿æ€»å’Œä¸º1
3. **ç»“æœä¿å­˜**: å¯ä»¥ä¿å­˜é›†æˆé¢„æµ‹ç»“æœç”¨äºè¿›ä¸€æ­¥åˆ†æ
4. **çµæ´»é…ç½®**: æ”¯æŒä¸åŒæ¨¡å‹æ¶æ„çš„ä»»æ„ç»„åˆ