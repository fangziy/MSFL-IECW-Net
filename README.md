# æ’æ˜Ÿå…‰è°±æ·±åº¦å­¦ä¹ åˆ†ææ¡†æ¶

<div align="center">

![Python](https://img.shields.io/badge/Python-3.8+-blue.svg)
![PyTorch](https://img.shields.io/badge/PyTorch-1.8+-red.svg)
![License](https://img.shields.io/badge/License-MIT-green.svg)

**ä¸€ä¸ªä¸“ä¸ºæ’æ˜Ÿå…‰è°±åˆ†æè®¾è®¡çš„æ·±åº¦å­¦ä¹ æ¡†æ¶ï¼Œä¸“æ³¨äºCEMPæ˜Ÿè¯†åˆ«å’Œæ’æ˜Ÿå¤§æ°”å‚æ•°é¢„æµ‹**

</div>

## ğŸ“‹ ç›®å½•

- [é¡¹ç›®ç®€ä»‹](#é¡¹ç›®ç®€ä»‹)
- [ä¸»è¦ç‰¹æ€§](#ä¸»è¦ç‰¹æ€§)
- [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
- [æ¨¡å‹æ¶æ„](#æ¨¡å‹æ¶æ„)
- [æ•°æ®æ ¼å¼](#æ•°æ®æ ¼å¼)
- [ä½¿ç”¨æŒ‡å—](#ä½¿ç”¨æŒ‡å—)
- [æ¨¡å‹èåˆ](#æ¨¡å‹èåˆ)
- [é…ç½®ç³»ç»Ÿ](#é…ç½®ç³»ç»Ÿ)
- [è¯„ä¼°æŒ‡æ ‡](#è¯„ä¼°æŒ‡æ ‡)
- [é¡¹ç›®ç»“æ„](#é¡¹ç›®ç»“æ„)
- [é«˜çº§åŠŸèƒ½](#é«˜çº§åŠŸèƒ½)
- [å­¦æœ¯èƒŒæ™¯](#å­¦æœ¯èƒŒæ™¯)

## ğŸŒŸ é¡¹ç›®ç®€ä»‹

æœ¬é¡¹ç›®æ˜¯ä¸€ä¸ªåŸºäºæ·±åº¦å­¦ä¹ çš„æ’æ˜Ÿå…‰è°±åˆ†ææ¡†æ¶ï¼Œä¸“é—¨ç”¨äºï¼š

- **CEMPæ˜Ÿè¯†åˆ«**: è¯†åˆ«ç¢³å¢å¼ºè´«é‡‘å±æ˜Ÿï¼ˆCarbon Enhanced Metal Poor starsï¼‰
- **æ’æ˜Ÿå¤§æ°”å‚æ•°å›å½’**: é¢„æµ‹é‡‘å±ä¸°åº¦ã€æœ‰æ•ˆæ¸©åº¦ã€è¡¨é¢é‡åŠ›ç­‰å‚æ•°
- **å¤šä»»åŠ¡å­¦ä¹ **: åŒæ—¶è¿›è¡Œåˆ†ç±»å’Œå›å½’ä»»åŠ¡
- **æ¨¡å‹èåˆ**: é›†æˆå¤šä¸ªæ¨¡å‹ä»¥æé«˜é¢„æµ‹æ€§èƒ½

### ç ”ç©¶æˆæœ

æœ¬é¡¹ç›®åŸºäºLAMOST DR8æ•°æ®é›†ï¼Œå®ç°äº†ï¼š
- **MPæ˜Ÿæœå¯»**: Recall=0.9592, Precision=0.9493, F1=0.9542
- **CEMPæ˜Ÿæœå¯»**: Recall=0.6428, Precision=0.7826, F1=0.7058
- **å‚æ•°ä¼°è®¡**: Teff MAE=74.9K, logg MAE=0.1749, [Fe/H] MAE=0.0889
- **å¤§è§„æ¨¡åº”ç”¨**: å‘ç°819,671é¢—è´«é‡‘å±æ˜Ÿå€™é€‰ä½“ï¼Œ12,766é¢—å¯Œç¢³è´«é‡‘å±æ˜Ÿå€™é€‰ä½“

## âœ¨ ä¸»è¦ç‰¹æ€§

### ğŸ—ï¸ å¤šç§ç¥ç»ç½‘ç»œæ¶æ„
- **MPBDNet**: å¤šåˆ†æ”¯åŒå‘å·ç§¯ç½‘ç»œï¼Œä¸“ä¸ºå…‰è°±åˆ†æè®¾è®¡
- **BGANet**: åŸºäºæ³¨æ„åŠ›æœºåˆ¶çš„åŒå‘GRUç½‘ç»œ
- **StarNet**: ç»å…¸çš„å¤©ä½“ç‰©ç†å…‰è°±åˆ†æç½‘ç»œ
- **RRNet**: æ®‹å·®ç½‘ç»œï¼Œæ”¯æŒå¤šç§æ¨¡å¼ï¼ˆraw/pre-RNN/post-RNNï¼‰

### ğŸ¯ çµæ´»çš„ä»»åŠ¡é…ç½®
- **åˆ†ç±»ä»»åŠ¡** (`cls`): CEMPæ˜Ÿä¸‰åˆ†ç±»ï¼ˆMP/CEMP/NMPï¼‰
- **å›å½’ä»»åŠ¡** (`reg`): äº”ä¸ªæ’æ˜Ÿå¤§æ°”å‚æ•°é¢„æµ‹
- **è”åˆä»»åŠ¡** (`cls_reg`): åŒæ—¶è¿›è¡Œåˆ†ç±»å’Œå›å½’

### ğŸ”§ å¼ºå¤§çš„å·¥å…·é›†
- **æ™ºèƒ½è®­ç»ƒ**: è‡ªåŠ¨å­¦ä¹ ç‡è°ƒåº¦ã€æ—©åœæœºåˆ¶
- **æ¨¡å‹èåˆ**: åŠ æƒå¹³å‡é›†æˆå¤šä¸ªæ¨¡å‹
- **ç‰¹å¾åˆ†æ**: å…‰è°±ç‰¹å¾é‡è¦æ€§åˆ†æ
- **æ•°æ®å¯è§†åŒ–**: æ•°æ®é¢„å¤„ç†å¯è§†åŒ–å·¥å…·

### ğŸ“Š ä¸“ä¸šè¯„ä¼°
- **CEMPæ˜Ÿä¸“é—¨æŒ‡æ ‡**: é’ˆå¯¹æ­£æ ·æœ¬çš„precision/recall/F1
- **å¤šçº§åˆ«è¯„ä¼°**: å•ç±»åˆ«å’Œæ•´ä½“åŠ æƒå¹³å‡æŒ‡æ ‡
- **å›å½’æŒ‡æ ‡**: MAEç­‰ä¸“ä¸šå¤©ä½“ç‰©ç†è¯„ä¼°æŒ‡æ ‡

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

```bash
Python >= 3.8
PyTorch >= 1.8
NumPy >= 1.19
Pandas >= 1.3
Scikit-learn >= 0.24
PyYAML >= 5.4
```

### å®‰è£…ç¯å¢ƒ

```bash
# åˆ›å»ºcondaç¯å¢ƒï¼ˆæ¨èï¼‰
conda create -n stellar_analysis python=3.8 pytorch==2.0.0 cudatoolkit=11.8 -c pytorch
conda activate stellar_analysis

# å®‰è£…ä¾èµ–
pip install numpy pandas scikit-learn pyyaml tqdm matplotlib seaborn
```

### æ•°æ®å‡†å¤‡

å°†æ‚¨çš„æ•°æ®æŒ‰ä»¥ä¸‹ç»“æ„ç»„ç»‡ï¼š

```
data/
â”œâ”€â”€ train/
â”‚   â”œâ”€â”€ X_train.npy    # è®­ç»ƒå…‰è°±æ•°æ® [N, spectrum_length]
â”‚   â””â”€â”€ y_train.csv    # è®­ç»ƒæ ‡ç­¾
â”œâ”€â”€ val/
â”‚   â”œâ”€â”€ X_val.npy      # éªŒè¯å…‰è°±æ•°æ®
â”‚   â””â”€â”€ y_val.csv      # éªŒè¯æ ‡ç­¾
â””â”€â”€ spectra/           # åŸå§‹å…‰è°±æ–‡ä»¶ï¼ˆå¯é€‰ï¼‰
```

### åŸºç¡€ä½¿ç”¨

```bash
# è®­ç»ƒCEMPæ˜Ÿåˆ†ç±»æ¨¡å‹
python train.py --config=./config/MPBD_cls.yaml

# è®­ç»ƒæ’æ˜Ÿå‚æ•°å›å½’æ¨¡å‹
python train.py --config=./config/MPBD_reg.yaml

# éªŒè¯æ¨¡å‹æ€§èƒ½
python val.py --config=./config/MPBD_cls.yaml

# æ¨¡å‹èåˆ
python ensemble.py --config=./config/ensemble_cls.yaml
```

## ğŸ›ï¸ æ¨¡å‹æ¶æ„

### æ•´ä½“æ¡†æ¶æ¦‚è§ˆ

```mermaid
graph TB
    A[è¾“å…¥å…‰è°±æ•°æ®] --> B[æ•°æ®é¢„å¤„ç†]
    B --> C[æ¨¡å‹é€‰æ‹©]
    C --> D1[MPBDNet]
    C --> D2[BGANet]
    C --> D3[StarNet]
    C --> D4[RRNet]
    D1 --> E[ç‰¹å¾æå–]
    D2 --> E
    D3 --> E
    D4 --> E
    E --> F[ä»»åŠ¡å¤´]
    F --> G1[åˆ†ç±»è¾“å‡º]
    F --> G2[å›å½’è¾“å‡º]
    F --> G3[è”åˆè¾“å‡º]
    G1 --> H[æ¨¡å‹èåˆ]
    G2 --> H
    G3 --> H
    H --> I[æœ€ç»ˆé¢„æµ‹]
```

### MPBDNet - å¤šåˆ†æ”¯åŒå‘ç½‘ç»œ



**æ¶æ„ç‰¹ç‚¹:**
- **å¤šå°ºåº¦ç‰¹å¾æå–**: 3Ã—3å’Œ5Ã—7å·ç§¯æ•è·ä¸åŒé¢‘ç‡ç‰¹å¾
- **åŒå‘åºåˆ—å»ºæ¨¡**: LSTMå¤„ç†å…‰è°±çš„å…¨å±€ä¾èµ–å…³ç³»
- **æ³¨æ„åŠ›æœºåˆ¶**: èšç„¦é‡è¦çš„å…‰è°±åŒºåŸŸ
- **ä¼˜åŠ¿**: é€‚åˆå…‰è°±æ•°æ®çš„é¢‘ç‡ç‰¹æ€§ï¼Œé«˜ç²¾åº¦åˆ†ç±»å’Œå›å½’



## ğŸ“Š æ•°æ®æ ¼å¼

### å…‰è°±æ•°æ®
- **æ ¼å¼**: NumPyæ•°ç»„ (.npy)
- **å½¢çŠ¶**: `[æ ·æœ¬æ•°, å…‰è°±é•¿åº¦]`
- **èŒƒå›´**: é€šå¸¸å·²å½’ä¸€åŒ–åˆ° [0, 1] æˆ–æ ‡å‡†åŒ–

### æ ‡ç­¾æ•°æ®
- **æ ¼å¼**: CSVæ–‡ä»¶
- **å›å½’æ ‡ç­¾**: `["FeH", "CH", "Teff", "logg", "CFe"]`
  - FeH: é“ä¸°åº¦ [Fe/H]
  - CH: ç¢³ä¸°åº¦ [C/H]
  - Teff: æœ‰æ•ˆæ¸©åº¦ (K)
  - logg: è¡¨é¢é‡åŠ› log(g)
  - CFe: ç¢³é“æ¯” [C/Fe]
- **åˆ†ç±»æ ‡ç­¾**: `['f_CEMP']`
  - 0: MP (Metal Poor) - è´«é‡‘å±æ˜Ÿ
  - 1: CEMP (Carbon Enhanced Metal Poor) - ç¢³å¢å¼ºè´«é‡‘å±æ˜Ÿ
  - 2: NMP (Non Metal Poor) - éè´«é‡‘å±æ˜Ÿ

## ğŸ“– ä½¿ç”¨æŒ‡å—

### è®­ç»ƒæ¨¡å‹

```bash
# åŸºç¡€è®­ç»ƒ
python train.py --config=config/æ¨¡å‹_ä»»åŠ¡.yaml

# æŒ‡å®šGPU
CUDA_VISIBLE_DEVICES=0 python train.py --config=config/BGANet_cls.yaml

# ä»æ£€æŸ¥ç‚¹æ¢å¤
python train.py --config=config/MPBD_reg.yaml
```

### éªŒè¯å’Œæµ‹è¯•

```bash
# éªŒè¯å•ä¸ªæ¨¡å‹
python val.py --config=config/StarNet_cls.yaml

# åœ¨å…¨éƒ¨æ•°æ®ä¸Šè¯„ä¼°
python val.py --config=config/RRNet_reg.yaml
```

### ç‰¹å¾é‡è¦æ€§åˆ†æ

```bash
# åˆ†æå…‰è°±ç‰¹å¾é‡è¦æ€§
python feature_importance_analysis.py --config=config/MPBD_cls.yaml --num_noise_block=10
```

### æ•°æ®å¯è§†åŒ–

```bash
# æ•°æ®é¢„å¤„ç†å¯è§†åŒ–
python tools/vision_data_prepocess.py
```

### æ•°æ®å¢å¼º

æ¡†æ¶æ”¯æŒå¤šç§å…‰è°±æ•°æ®å¢å¼ºæ–¹æ³•ï¼Œé€šè¿‡é…ç½®æ–‡ä»¶çµæ´»æ§åˆ¶ï¼Œæé«˜æ¨¡å‹çš„æ³›åŒ–èƒ½åŠ›å’Œé²æ£’æ€§ã€‚

#### å¢å¼ºæ–¹æ³•æ¦‚è§ˆ

```mermaid
graph TB
    A[åŸå§‹å…‰è°±] --> B{å¢å¼ºæ¦‚ç‡}
    B -->|p| C[é€‰æ‹©å¢å¼ºæ–¹æ³•]
    B -->|1-p| D[ä¿æŒåŸæ ·]
    
    C --> E1[é«˜æ–¯å™ªå£°]
    C --> E2[å…‰è°±ç¼©æ”¾]
    C --> E3[åŸºçº¿æ¼‚ç§»]
    C --> E4[æ³¢é•¿åç§»]
    C --> E5[å…‰è°±å¹³æ»‘]
    C --> E6[å…‰è°±Dropout]
    
    E1 --> F[å¢å¼ºåå…‰è°±]
    E2 --> F
    E3 --> F
    E4 --> F
    E5 --> F
    E6 --> F
    D --> F
    
    style A fill:#e1f5fe
    style F fill:#c8e6c9
    style C fill:#f3e5f5
```

#### å¢å¼ºæ•ˆæœå¯è§†åŒ–

```mermaid
graph LR
    A[åŸå§‹å…‰è°±<br/>è¿ç»­å¹³æ»‘] --> B[é«˜æ–¯å™ªå£°<br/>+éšæœºæ‰°åŠ¨]
    A --> C[å…‰è°±ç¼©æ”¾<br/>+å¹…åº¦å˜åŒ–]
    A --> D[åŸºçº¿æ¼‚ç§»<br/>+è¶‹åŠ¿å˜åŒ–]
    A --> E[æ³¢é•¿åç§»<br/>+ç›¸ä½å˜åŒ–]
    
    subgraph "å¢å¼ºç›®æ ‡"
        F[æé«˜æ³›åŒ–èƒ½åŠ›]
        G[å¢å¼ºé²æ£’æ€§]
        H[æ¨¡æ‹ŸçœŸå®å™ªå£°]
    end
    
    style A fill:#e1f5fe
    style B fill:#fff3e0
    style C fill:#fff3e0
    style D fill:#fff3e0
    style E fill:#fff3e0
```

#### ä½¿ç”¨æ–¹æ³•

```bash
# ä½¿ç”¨æ•°æ®å¢å¼ºè®­ç»ƒ
python train.py --config=config/MPBD_cls_with_augmentation.yaml

# æµ‹è¯•æ•°æ®å¢å¼ºåŠŸèƒ½
python test_augmentation.py
```

#### æ”¯æŒçš„å¢å¼ºæ–¹æ³•

| æ–¹æ³• | æè¿° | å‚æ•° | æ•ˆæœ |
|------|------|------|------|
| **é«˜æ–¯å™ªå£°** | æ·»åŠ éšæœºé«˜æ–¯å™ªå£° | `std`: å™ªå£°æ ‡å‡†å·® | æ¨¡æ‹Ÿä»ªå™¨å™ªå£° |
| **å…‰è°±ç¼©æ”¾** | éšæœºç¼©æ”¾å…‰è°±å¹…åº¦ | `range`: ç¼©æ”¾èŒƒå›´ | æ¨¡æ‹Ÿä»ªå™¨å“åº”å·®å¼‚ |
| **åŸºçº¿æ¼‚ç§»** | æ·»åŠ çº¿æ€§åŸºçº¿æ¼‚ç§» | `slope_range`: æ–œç‡èŒƒå›´ | æ¨¡æ‹Ÿè§‚æµ‹æ¡ä»¶å˜åŒ– |
| **æ³¢é•¿åç§»** | éšæœºåç§»æ³¢é•¿è½´ | `shift_range`: åç§»èŒƒå›´ | æ¨¡æ‹Ÿå…‰è°±æ ¡å‡†è¯¯å·® |
| **å…‰è°±å¹³æ»‘** | é«˜æ–¯æ»¤æ³¢å¹³æ»‘ | `sigma`: å¹³æ»‘å‚æ•° | æ¨¡æ‹Ÿä¸åŒåˆ†è¾¨ç‡ |
| **å…‰è°±Dropout** | éšæœºé®æŒ¡æ³¢æ®µ | `dropout_rate`: é®æŒ¡æ¯”ä¾‹ | æ¨¡æ‹Ÿéƒ¨åˆ†æ³¢æ®µç¼ºå¤± |

#### é…ç½®ç¤ºä¾‹

```yaml
# åœ¨é…ç½®æ–‡ä»¶ä¸­æ·»åŠ æ•°æ®å¢å¼º
data_augmentation:
  probability: 0.6  # 60%çš„æ ·æœ¬ä¼šè¢«å¢å¼º
  methods:
    gaussian_noise:
      enabled: True
      probability: 0.4
      std: 0.008
    spectral_scaling:
      enabled: True  
      probability: 0.3
      range: 0.08
    baseline_drift:
      enabled: True
      probability: 0.2
      slope_range: 0.001
    wavelength_shift:
      enabled: True
      probability: 0.2
      shift_range: 2
    spectral_smoothing:
      enabled: True
      probability: 0.1
      sigma: 1.0
    spectral_dropout:
      enabled: True
      probability: 0.1
      dropout_rate: 0.05
```

## ğŸ”„ æ¨¡å‹èåˆ

æ¨¡å‹èåˆé€šè¿‡é›†æˆå¤šä¸ªæ¨¡å‹æ¥æé«˜é¢„æµ‹æ€§èƒ½ï¼Œç‰¹åˆ«é€‚åˆæå‡CEMPæ˜Ÿè¯†åˆ«çš„å‡†ç¡®æ€§ã€‚

### èåˆæ¶æ„å›¾

```mermaid
graph TB
    A[è¾“å…¥å…‰è°±] --> B1[model1]
    A --> B2[model2]
    A --> B3[model3]
    A --> B4[model4]
    
    B1 --> C1[é¢„æµ‹1]
    B2 --> C2[é¢„æµ‹2]
    B3 --> C3[é¢„æµ‹3]
    B4 --> C4[é¢„æµ‹4]
    
    C1 --> D[æƒé‡åˆ†é…]
    C2 --> D
    C3 --> D
    C4 --> D
    
    D --> E[åŠ æƒå¹³å‡]
    E --> F[æœ€ç»ˆé¢„æµ‹]
    
    subgraph "æƒé‡è®¡ç®—"
        G[æ¨¡å‹æ€§èƒ½è¯„ä¼°]
        H[æƒé‡å½’ä¸€åŒ–]
        I[åŠ¨æ€è°ƒæ•´]
    end
    
    G --> H
    H --> I
    I --> D
    
    style A fill:#e1f5fe
    style F fill:#c8e6c9
    style D fill:#f3e5f5
```

### èåˆæµç¨‹

```mermaid
sequenceDiagram
    participant U as ç”¨æˆ·
    participant E as èåˆå¼•æ“
    participant M1 as MPBDNet
    participant M2 as BGANet
    participant M3 as StarNet
    participant W as æƒé‡è®¡ç®—å™¨
    
    U->>E: åŠ è½½èåˆé…ç½®
    E->>M1: åŠ è½½æ¨¡å‹æƒé‡
    E->>M2: åŠ è½½æ¨¡å‹æƒé‡
    E->>M3: åŠ è½½æ¨¡å‹æƒé‡
    
    U->>E: è¾“å…¥å…‰è°±æ•°æ®
    E->>M1: å‰å‘ä¼ æ’­
    E->>M2: å‰å‘ä¼ æ’­
    E->>M3: å‰å‘ä¼ æ’­
    
    M1-->>E: é¢„æµ‹ç»“æœ1
    M2-->>E: é¢„æµ‹ç»“æœ2
    M3-->>E: é¢„æµ‹ç»“æœ3
    
    E->>W: è®¡ç®—èåˆæƒé‡
    W-->>E: å½’ä¸€åŒ–æƒé‡
    E->>E: åŠ æƒå¹³å‡
    E-->>U: æœ€ç»ˆé¢„æµ‹ç»“æœ
```

### åŸºæœ¬ç”¨æ³•

```bash
# åˆ†ç±»ä»»åŠ¡èåˆ
python ensemble.py --config=config/ensemble_cls.yaml

# å›å½’ä»»åŠ¡èåˆ  
python ensemble.py --config=config/ensemble_reg.yaml

# è”åˆä»»åŠ¡èåˆ
python ensemble.py --config=config/ensemble_cls_reg.yaml

# ä¿å­˜é¢„æµ‹ç»“æœ
python ensemble.py --config=config/ensemble_cls.yaml --save_predictions --output_dir=./results
```

### é…ç½®ç¤ºä¾‹

```yaml
# èåˆé…ç½®æ–‡ä»¶
object_type: 'cls'
data_dir: "data/"

models:
  - name: 'MPBDNet'
    path: 'model_save/MPBD_cls/best.pth'
    weight: 1.2  # æ€§èƒ½æœ€å¥½ï¼Œæƒé‡æœ€é«˜
    
  - name: 'BGANet'
    path: 'model_save/BGANet_cls/best.pth'
    weight: 1.0
    
  - name: 'StarNet'
    path: 'model_save/StarNet_cls/best.pth'
    weight: 0.8  # åŸºå‡†æ¨¡å‹ï¼Œæƒé‡è¾ƒä½
```

### èåˆç­–ç•¥

| ç­–ç•¥ | æè¿° | ä¼˜åŠ¿ | é€‚ç”¨åœºæ™¯ |
|------|------|------|----------|
| **åŠ æƒå¹³å‡** | æ ¹æ®æ¨¡å‹æ€§èƒ½åˆ†é…æƒé‡ | ç®€å•æœ‰æ•ˆï¼Œè®¡ç®—å¿«é€Ÿ | æ¨¡å‹æ€§èƒ½å·®å¼‚æ˜æ˜¾ |
| **è‡ªåŠ¨å½’ä¸€åŒ–** | æƒé‡è‡ªåŠ¨æ ‡å‡†åŒ–åˆ°[0,1] | é¿å…æƒé‡è¿‡å¤§æˆ–è¿‡å° | æƒé‡å·®å¼‚è¾ƒå¤§æ—¶ |
| **åŠ¨æ€è°ƒæ•´** | æ ¹æ®éªŒè¯é›†æ€§èƒ½è°ƒæ•´æƒé‡ | è‡ªé€‚åº”ä¼˜åŒ– | æ•°æ®åˆ†å¸ƒå˜åŒ–æ—¶ |
| **æŠ•ç¥¨æœºåˆ¶** | å¤šæ•°æŠ•ç¥¨å†³å®šæœ€ç»ˆç»“æœ | é²æ£’æ€§å¼º | åˆ†ç±»ä»»åŠ¡ |



## âš™ï¸ é…ç½®ç³»ç»Ÿ

### é…ç½®æ–‡ä»¶ç»“æ„

```yaml
# åŸºæœ¬é…ç½®
object_type: 'cls'          # ä»»åŠ¡ç±»å‹: 'cls', 'reg', 'cls_reg'
data_dir: "data/"           # æ•°æ®ç›®å½•
object_name: 'MPBD_cls'     # å®éªŒåç§°

# æ•°æ®é…ç½®
reg_columns: ["FeH", "CH", "Teff", "logg", "CFe"]
cls_columns: ['f_CEMP']
cls_dict: {0: 'MP', 1: 'CEMP', 2: 'NMP'}

# æ ‡å‡†åŒ–å‚æ•°
y_mean: [-8.81020067e-01, -9.78005818e-01, 4.91095684e+03, 2.55795385e+00, -9.69857512e-02]
y_std: [7.61077821e-01, 8.42965361e-01, 4.97515564e+02, 1.15882902e+00, 3.06636238e-01]

# æ¨¡å‹é…ç½®
model:
  name: 'MPBDNet'
  list_inplanes: [20,40,80,160]
  len_spectrum: 4900

# è®­ç»ƒé…ç½®
lr: 0.0001
num_epochs: 200

# æŸå¤±å‡½æ•°
loss:
  cls_loss:
    loss_name: 'CrossEntropyLoss'
    rate: 1.0

# å­¦ä¹ ç‡è°ƒåº¦
scheduler:
  name: 'StepLR'
  step_size: 30
  gamma: 0.75

# æ¨¡å‹ä¿å­˜
resume_from: 'model_save/MPBD_cls/best.pth'
```

### å¯ç”¨é…ç½®æ–‡ä»¶

- **åˆ†ç±»ä»»åŠ¡**: `*_cls.yaml`
- **å›å½’ä»»åŠ¡**: `*_reg.yaml`  
- **è”åˆä»»åŠ¡**: `*_cls_reg.yaml`
- **èåˆé…ç½®**: `ensemble_*.yaml`

## ğŸ“ é¡¹ç›®ç»“æ„


### è¯¦ç»†æ–‡ä»¶ç»“æ„

```
thesis/
â”œâ”€â”€ config/                     # é…ç½®æ–‡ä»¶ç›®å½•
â”‚   â”œâ”€â”€ MPBD_cls.yaml          # MPBDåˆ†ç±»é…ç½®
â”‚   â”œâ”€â”€ MPBD_reg.yaml          # MPBDå›å½’é…ç½®
â”‚   â”œâ”€â”€ MPBD_reg_cls.yaml      # MPBDè”åˆä»»åŠ¡é…ç½®
â”‚   â”œâ”€â”€ BGANet_cls.yaml        # BGANetåˆ†ç±»é…ç½®
â”‚   â”œâ”€â”€ BGANet_reg.yaml        # BGANetå›å½’é…ç½®
â”‚   â”œâ”€â”€ BGANet_cls_reg.yaml    # BGANetè”åˆä»»åŠ¡é…ç½®
â”‚   â”œâ”€â”€ StarNet_cls.yaml       # StarNetåˆ†ç±»é…ç½®
â”‚   â”œâ”€â”€ RRNet_cls.yaml         # RRNetåˆ†ç±»é…ç½®
â”‚   â”œâ”€â”€ RRNet_reg.yaml         # RRNetå›å½’é…ç½®
â”‚   â””â”€â”€ ensemble_*.yaml        # æ¨¡å‹èåˆé…ç½®
â”œâ”€â”€ data/                       # æ•°æ®ç›®å½•
â”‚   â”œâ”€â”€ train/                 # è®­ç»ƒæ•°æ®
â”‚   â”‚   â”œâ”€â”€ X_train.npy        # è®­ç»ƒå…‰è°±æ•°æ®
â”‚   â”‚   â””â”€â”€ y_train.csv        # è®­ç»ƒæ ‡ç­¾
â”‚   â”œâ”€â”€ val/                   # éªŒè¯æ•°æ®
â”‚   â”‚   â”œâ”€â”€ X_val.npy          # éªŒè¯å…‰è°±æ•°æ®
â”‚   â”‚   â””â”€â”€ y_val.csv          # éªŒè¯æ ‡ç­¾
â”‚   â””â”€â”€ spectra/               # åŸå§‹å…‰è°±æ–‡ä»¶
â”œâ”€â”€ models/                     # æ¨¡å‹å®šä¹‰
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ MPBDNet.py             # MPBDç½‘ç»œ
â”‚   â”œâ”€â”€ BGANet.py              # BGANç½‘ç»œ
â”‚   â”œâ”€â”€ StarNet.py             # StarNetç½‘ç»œ
â”‚   â”œâ”€â”€ RRNet.py               # RRNetç½‘ç»œ
â”‚   â”œâ”€â”€ create/                # æ¨¡å‹åˆ›å»ºå·¥å…·
â”‚   â”‚   â”œâ”€â”€ create_loss.py     # æŸå¤±å‡½æ•°åˆ›å»º
â”‚   â”‚   â””â”€â”€ create_scheduler.py # è°ƒåº¦å™¨åˆ›å»º
â”‚   â””â”€â”€ loss/                  # æŸå¤±å‡½æ•°
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ focal.py           # Focal Loss
â”‚       â””â”€â”€ gaussian_nll.py    # é«˜æ–¯è´Ÿå¯¹æ•°ä¼¼ç„¶
â”œâ”€â”€ model_save/                 # æ¨¡å‹ä¿å­˜ç›®å½•
â”‚   â”œâ”€â”€ MPBD_cls/              # MPBDåˆ†ç±»æ¨¡å‹
â”‚   â”œâ”€â”€ MPBD_reg/              # MPBDå›å½’æ¨¡å‹
â”‚   â”œâ”€â”€ MPBD_reg_cls/          # MPBDè”åˆä»»åŠ¡æ¨¡å‹
â”‚   â”œâ”€â”€ BGANet_cls/            # BGANetåˆ†ç±»æ¨¡å‹
â”‚   â”œâ”€â”€ BGANet_reg/            # BGANetå›å½’æ¨¡å‹
â”‚   â”œâ”€â”€ BGANet_cls_reg/        # BGANetè”åˆä»»åŠ¡æ¨¡å‹
â”‚   â”œâ”€â”€ StarNet_cls/           # StarNetåˆ†ç±»æ¨¡å‹
â”‚   â”œâ”€â”€ RRNet_cls/             # RRNetåˆ†ç±»æ¨¡å‹
â”‚   â””â”€â”€ RRNet_reg/             # RRNetå›å½’æ¨¡å‹
â”œâ”€â”€ out_csv/                    # è¾“å‡ºç»“æœ
â”‚   â”œâ”€â”€ BGANet_cls/            # BGANetåˆ†ç±»ç»“æœ
â”‚   â”œâ”€â”€ MPBD_cls/              # MPBDåˆ†ç±»ç»“æœ
â”‚   â””â”€â”€ MPBD_reg/              # MPBDå›å½’ç»“æœ
â”œâ”€â”€ tools/                      # å·¥å…·è„šæœ¬
â”‚   â””â”€â”€ vision_data_prepocess.py # æ•°æ®é¢„å¤„ç†å¯è§†åŒ–
â”œâ”€â”€ utils/                      # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ tools.py               # é€šç”¨å·¥å…·å‡½æ•°
â”‚   â””â”€â”€ pylamost/              # LAMOSTæ•°æ®å¤„ç†
â”œâ”€â”€ fig/                        # å›¾è¡¨è¾“å‡º
â”‚   â”œâ”€â”€ data_preprocessing/     # æ•°æ®é¢„å¤„ç†å›¾è¡¨
â”‚   â””â”€â”€ MPBD_reg/              # MPBDå›å½’ç»“æœå›¾è¡¨
â”œâ”€â”€ ppt/                        # æ¼”ç¤ºæ–‡ç¨¿
â”œâ”€â”€ train.py                    # è®­ç»ƒè„šæœ¬
â”œâ”€â”€ val.py                      # éªŒè¯è„šæœ¬
â”œâ”€â”€ ensemble.py                 # æ¨¡å‹èåˆè„šæœ¬
â”œâ”€â”€ feature_importance_analysis.py # ç‰¹å¾é‡è¦æ€§åˆ†æ
â””â”€â”€ README.md                   # é¡¹ç›®è¯´æ˜
```

## ğŸ”¬ é«˜çº§åŠŸèƒ½

### 1. è‡ªé€‚åº”æŸå¤±å‡½æ•°
- **Focal Loss**: å¤„ç†ç±»åˆ«ä¸å¹³è¡¡
- **Gaussian NLL**: ä¸ç¡®å®šæ€§é‡åŒ–
- **åŠ æƒæŸå¤±**: è‡ªå®šä¹‰ç±»åˆ«æƒé‡

### 2. å­¦ä¹ ç‡è°ƒåº¦
- **StepLR**: é˜¶æ¢¯å¼è¡°å‡
- **CosineAnnealingLR**: ä½™å¼¦é€€ç«
- **ReduceLROnPlateau**: è‡ªé€‚åº”è°ƒæ•´

### 3. ç‰¹å¾é‡è¦æ€§åˆ†æ
```bash
python feature_importance_analysis.py \
    --config=config/MPBD_cls.yaml \
    --num_noise_block=10
```

### 4. æ¨¡å‹è§£é‡Šæ€§
- æ³¨æ„åŠ›æƒé‡å¯è§†åŒ–ï¼ˆBGANetï¼‰
- ç‰¹å¾æ•æ„Ÿæ€§åˆ†æ
- å…‰è°±åŒºåŸŸé‡è¦æ€§è¯„ä¼°

### 5. ç”Ÿäº§éƒ¨ç½²
- æ¨¡å‹æƒé‡ä¿å­˜/åŠ è½½
- é¢„æµ‹ç»“æœå¯¼å‡º
- æ‰¹é‡æ¨ç†æ”¯æŒ

### 6. å…‰è°±æ•°æ®å¢å¼º
```bash
# æ•°æ®å¢å¼ºé…ç½®ç¤ºä¾‹
data_augmentation:
  probability: 0.6  # æ•´ä½“å¢å¼ºæ¦‚ç‡
  methods:
    gaussian_noise:     # é«˜æ–¯å™ªå£°
      enabled: True
      probability: 0.4
      std: 0.008
    spectral_scaling:   # å…‰è°±ç¼©æ”¾
      enabled: True
      probability: 0.3
      range: 0.08
    baseline_drift:     # åŸºçº¿æ¼‚ç§»
      enabled: True
      probability: 0.35
      strength: 0.015
    wavelength_shift:   # æ³¢é•¿åç§»
      enabled: True
      probability: 0.25
      max_shift: 3
```

**å¢å¼ºæ–¹æ³•è¯´æ˜**ï¼š
- **é€‚ç”¨åœºæ™¯**: å°æ ·æœ¬å­¦ä¹ ã€æé«˜æ¨¡å‹æ³›åŒ–æ€§
- **ç‰©ç†æ„ä¹‰**: æ¨¡æ‹ŸçœŸå®è§‚æµ‹ä¸­çš„å„ç§è¯¯å·®å’Œå˜åŒ–
- **é…ç½®çµæ´»**: æ¯ç§æ–¹æ³•å¯ç‹¬ç«‹å¯ç”¨/ç¦ç”¨å’Œè°ƒå‚
- **è®­ç»ƒä¸“ç”¨**: ä»…åœ¨è®­ç»ƒæ—¶åº”ç”¨ï¼ŒéªŒè¯æ—¶ä¸ä½¿ç”¨

## ğŸ¯ æœ€ä½³å®è·µ

### è®­ç»ƒå»ºè®®
1. **æ•°æ®é¢„å¤„ç†**: ç¡®ä¿å…‰è°±æ•°æ®å·²æ­£ç¡®å½’ä¸€åŒ–
2. **è¶…å‚æ•°è°ƒä¼˜**: å…ˆç”¨å°å­¦ä¹ ç‡æ‰¾åˆ°æ”¶æ•›èŒƒå›´
3. **æ—©åœæœºåˆ¶**: ç›‘æ§éªŒè¯æŸå¤±é¿å…è¿‡æ‹Ÿåˆ
4. **æ¨¡å‹é€‰æ‹©**: MPBDå’ŒBGANeté€šå¸¸è¡¨ç°æœ€ä½³
5. **æ•°æ®å¢å¼º**: 
   - å°æ ·æœ¬æ•°æ®é›†å»ºè®®ä½¿ç”¨è½»é‡çº§å¢å¼º
   - å¤§æ ·æœ¬æ•°æ®é›†å¯ä½¿ç”¨æ›´æ¿€è¿›çš„å¢å¼ºç­–ç•¥
   - å…ˆä¸ç”¨å¢å¼ºå»ºç«‹åŸºçº¿ï¼Œå†é€æ­¥æ·»åŠ å¢å¼ºæ–¹æ³•

### èåˆç­–ç•¥
1. **æ¨¡å‹å¤šæ ·æ€§**: é€‰æ‹©ä¸åŒæ¶æ„çš„æ¨¡å‹èåˆ
2. **æƒé‡è°ƒä¼˜**: æ ¹æ®éªŒè¯é›†æ€§èƒ½è°ƒæ•´æƒé‡
3. **ç»“æœåˆ†æ**: å…³æ³¨CEMPæ˜Ÿçš„ä¸“é—¨æŒ‡æ ‡

### æ€§èƒ½ä¼˜åŒ–
1. **æ‰¹é‡å¤§å°**: æ ¹æ®GPUå†…å­˜è°ƒæ•´
2. **æ··åˆç²¾åº¦**: ä½¿ç”¨FP16åŠ é€Ÿè®­ç»ƒ
3. **æ•°æ®å¹¶è¡Œ**: å¤šGPUè®­ç»ƒå¤§å‹æ¨¡å‹

## ğŸ“š å­¦æœ¯èƒŒæ™¯

### LAMOSTä¸CEMPæ˜Ÿç ”ç©¶

å¤§å¤©åŒºé¢ç§¯å¤šç›®æ ‡å…‰çº¤å…‰è°±æœ›è¿œé•œ (LAMOST) æ˜¯æˆ‘å›½è‡ªä¸»ç ”å‘çš„å¤§å‹å…‰å­¦è§‚æµ‹è®¾å¤‡ï¼Œä¸ºå¤©æ–‡å­¦ç ”ç©¶æä¾›äº†å…³é”®çš„æ•°æ®æ”¯æŒã€‚è´«é‡‘å±(Metal-Poor, MP)æ˜Ÿæ˜¯ä¸€ç±»ç¨€æœ‰è€Œå¤è€çš„æ’æ˜Ÿï¼Œè€Œç¢³å¢å¼ºè´«é‡‘å±(Carbon-Enhanced Metal-Poor, CEMP)æ˜Ÿåˆ™æ˜¯å…¶ä¸­çš„é‡è¦å­ç±»ï¼Œæ˜¾ç¤ºå‡ºç›¸å¯¹äºé“å…ƒç´ çš„ç¢³å¯Œé›†æ•ˆåº”ã€‚

CEMPæ˜Ÿè¢«è®¤ä¸ºæ˜¯ç”±å¤§çˆ†ç‚¸åç¬¬ä¸€ä»£æ’æ˜Ÿæ±¡æŸ“çš„æ°”ä½“å½¢æˆçš„ï¼Œæ˜¯ç ”ç©¶æ—©æœŸå®‡å®™ã€æ˜Ÿç³»æ¼”åŒ–å’Œæ ¸åˆæˆçš„é‡è¦å¯¹è±¡ã€‚æœ¬é¡¹ç›®é’ˆå¯¹MPåŠCEMPæ ·æœ¬çš„ç¨€ç¼ºæ€§é—®é¢˜ï¼Œè®¾è®¡äº†æ·±åº¦å­¦ä¹ æ–¹æ³•æ¥æé«˜è¿™ä¸¤ç±»æ ·æœ¬çš„æ£€å‡ºç‡å’Œå‚æ•°ä¼°è®¡ç²¾åº¦ã€‚

### æ•°æ®é›†æ„å»º

æœ¬å·¥ä½œä½¿ç”¨LAMOST DR8æ•°æ®é›†ï¼š
- **éè´«é‡‘å±æ˜Ÿæ ·æœ¬**: 4,723ä¸ª
- **è´«é‡‘å±æ˜Ÿæ ·æœ¬**: 5,032ä¸ªï¼ˆåŒ…å«167ä¸ªCEMPæ˜Ÿï¼‰
- **æ ‡ç­¾æ¥æº**: APOGEE DR17ã€LAMOST-Subaruã€SAGAæ•°æ®åº“
- **é¢„å¤„ç†**: ç»Ÿä¸€æ³¢æ®µæ’å€¼ã€è¿ç»­è°±æ‹Ÿåˆã€å½’ä¸€åŒ–

### æ ¸å¿ƒè´¡çŒ®

1. **å¤šå°ºåº¦ç‰¹å¾å­¦ä¹ **: æå‡ºMSFL-IECWç½‘ç»œï¼Œä½¿ç”¨å¤šå°ºåº¦å·ç§¯å’Œè·¨æ³¢æ®µLSTM
2. **åˆ†ç±»çº¦æŸå›å½’**: åŸºäºåˆ†ç±»çº¦æŸçš„å›å½’æ–¹æ³•ï¼Œé¿å…å‚æ•°ä¼°è®¡çš„ç‰©ç†çŸ›ç›¾
3. **å¤§è§„æ¨¡åº”ç”¨**: åœ¨LAMOST DR8ä¸Šå‘ç°å¤§é‡MPå’ŒCEMPæ˜Ÿå€™é€‰ä½“
4. **æœªæ¥å±•æœ›**: å¯åº”ç”¨äºCSSTç­‰å¤§å‹ç©ºé—´å¤©æ–‡è®¾æ–½

## ğŸ“ è”ç³»æ–¹å¼

- **ä½œè€…**: Ziyu Fang
- **é‚®ç®±**: fangziyushiwo@126.com
- **æ—¥æœŸ**: 2024-12-25

### å¼•ç”¨æ ¼å¼
```bibtex
@article{fang2025catalog,
  title={A Catalog of 12,766 Carbon-enhanced Metal-poor Stars from LAMOST Data Release 8},
  author={Fang, Ziyu and Li, Xiangru and Li, Haining},
  journal={The Astrophysical Journal Supplement Series},
  volume={277},
  number={1},
  pages={30},
  year={2025},
  publisher={IOP Publishing}
}
```

---

<div align="center">

**ğŸŒŸ å¦‚æœè¿™ä¸ªé¡¹ç›®å¯¹æ‚¨çš„ç ”ç©¶æœ‰å¸®åŠ©ï¼Œè¯·ç»™ä¸ªStarï¼**

*ä¸“ä¸ºå¤©ä½“ç‰©ç†å­¦å®¶å’Œæ•°æ®ç§‘å­¦å®¶è®¾è®¡çš„æ’æ˜Ÿå…‰è°±åˆ†æå·¥å…·*

</div>



```bash
# ä½¿ç”¨é¢„å®šä¹‰çš„é…ç½®æ–‡ä»¶è¿›è¡Œæ¨¡å‹èåˆ
python ensemble.py --config=./config/ensemble_cls.yaml

# ä¿å­˜é¢„æµ‹ç»“æœåˆ°æŒ‡å®šç›®å½•
python ensemble.py --config=./config/ensemble_cls.yaml --save_predictions --output_dir=./results

```

### é…ç½®æ–‡ä»¶è¯´æ˜

**åˆ†ç±»ä»»åŠ¡èåˆ**:
```bash
python ensemble.py --config=./config/ensemble_cls.yaml
```

**å›å½’ä»»åŠ¡èåˆ**:
```bash
python ensemble.py --config=./config/ensemble_reg.yaml
```

**åˆ†ç±»+å›å½’è”åˆä»»åŠ¡èåˆ**:
```bash
python ensemble.py --config=./config/ensemble_cls_reg.yaml
```

**ç®€å•ç­‰æƒé‡èåˆ**:
```bash
python ensemble.py --config=./config/ensemble_simple.yaml
```

### é…ç½®æ–‡ä»¶æ ¼å¼

```yaml
# åŸºæœ¬ä»»åŠ¡é…ç½®
object_type: 'cls'  # 'cls', 'reg', 'cls_reg'
data_dir: "è·¯å¾„/åˆ°/æ•°æ®ç›®å½•"

# èåˆæ¨¡å‹åˆ—è¡¨
models:
  - name: 'StarNet'
    path: 'æ¨¡å‹æƒé‡æ–‡ä»¶è·¯å¾„'
    weight: 1.0  # æ¨¡å‹æƒé‡ï¼Œæ•°å€¼è¶Šå¤§å½±å“è¶Šå¤§
    len_spectrum: 4900
    
  - name: 'RRNet'
    path: 'æ¨¡å‹æƒé‡æ–‡ä»¶è·¯å¾„'
    weight: 1.2  # ç»™è¡¨ç°æ›´å¥½çš„æ¨¡å‹æ›´é«˜æƒé‡
    list_inplanes: [20,40,80,160]
    len_spectrum: 3834
    mode: 'post-RNN'
```

### è¾“å‡ºç»“æœ

èåˆåä¼šè¾“å‡ºï¼š
- **é›†æˆæ¨¡å‹å‡†ç¡®ç‡**: æ•´ä½“é¢„æµ‹å‡†ç¡®æ€§
- **CEMPæ˜Ÿä¸“é—¨æŒ‡æ ‡**: é’ˆå¯¹CEMPæ˜Ÿçš„precisionã€recallã€F1
- **æ•´ä½“åŠ æƒå¹³å‡æŒ‡æ ‡**: è€ƒè™‘ç±»åˆ«å¹³è¡¡çš„æ•´ä½“æ€§èƒ½
- **MAE**: å›å½’ä»»åŠ¡çš„å¹³å‡ç»å¯¹è¯¯å·®

### é«˜çº§åŠŸèƒ½

1. **è‡ªå®šä¹‰æƒé‡**: å¯ä»¥æ ¹æ®å•ä¸ªæ¨¡å‹æ€§èƒ½è°ƒæ•´æƒé‡
2. **è‡ªåŠ¨å½’ä¸€åŒ–**: æƒé‡ä¼šè‡ªåŠ¨å½’ä¸€åŒ–ï¼Œç¡®ä¿æ€»å’Œä¸º1
3. **ç»“æœä¿å­˜**: å¯ä»¥ä¿å­˜é›†æˆé¢„æµ‹ç»“æœç”¨äºè¿›ä¸€æ­¥åˆ†æ
4. **çµæ´»é…ç½®**: æ”¯æŒä¸åŒæ¨¡å‹æ¶æ„çš„ä»»æ„ç»„åˆ